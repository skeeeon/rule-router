# NATS Rule Router Configuration
# High-Performance Message Routing with NATS JetStream and Key-Value Store Support

# NATS Server Connection Configuration
nats:
  urls:
    - nats://nats-server-1:4222
    - nats://nats-server-2:4222
    - nats://nats-server-3:4222
  
  # Authentication Options (choose one)
  # Option 1: Username/Password
  username: "rule-router-service"
  password: "secure-password"
  
  # Option 2: Token Authentication
  # token: "your-nats-token"
  
  # Option 3: NKey Authentication  
  # nkey: "your-nkey-here"
  
  # Option 4: JWT with .creds file (recommended for production)
  # credsFile: "/etc/nats/creds/rule-engine.creds"
  
  # TLS Configuration
  tls:
    enable: true
    certFile: "/etc/ssl/nats/client-cert.pem"
    keyFile: "/etc/ssl/nats/client-key.pem"
    caFile: "/etc/ssl/nats/ca.pem"
    insecure: false                    # Skip certificate verification

# NATS Key-Value Store Configuration
kv:
  enabled: true
  buckets:
    - "device_status"                  # Device operational status
    - "device_last_seen"               # Last seen timestamps
    - "user_preferences"               # User configuration data
    - "system_config"                  # System configuration values

# Watermill NATS JetStream Configuration
watermill:
  nats:
    maxReconnects: -1                  # Unlimited reconnects for resilience
    reconnectWait: 50ms                # Fast reconnection for high availability
    publishAsync: true                 # Critical for high throughput
    maxPendingAsync: 2000             # Support 2000+ msg/sec throughput
    subscriberCount: 8                 # Parallel consumers (2x CPU cores)
    ackWaitTimeout: 30s               # Message acknowledgment timeout
    maxDeliver: 3                     # Max redelivery attempts
    writeBufferSize: 2097152          # 2MB write buffer for performance
    reconnectBufSize: 16777216        # 16MB reconnect buffer
  
  router:
    closeTimeout: 30s                  # Graceful shutdown timeout
  
  middleware:
    retryMaxAttempts: 3                # Retry failed message processing
    retryInterval: 100ms               # Initial retry interval
    metricsEnabled: true               # Enable comprehensive metrics
    tracingEnabled: false              # Disable for performance

# Logging Configuration
logging:
  level: info                          # debug, info, warn, error
  outputPath: stdout                   # stdout or file path
  encoding: json                       # json or console

# Prometheus Metrics Configuration
metrics:
  enabled: true
  address: :2112
  path: /metrics
  updateInterval: 15s
